<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LootLedger V10: Pro Tuner</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --bg: #050505; --card: #111;
            --xp: #eab308; --needs: #3b82f6; --wants: #8b5cf6;
            --saves: #10b981; --fire: #f97316; --danger: #ef4444;
            --text: #fff; --dim: #666;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Rajdhani', sans-serif; user-select: none; }
        body { background: var(--bg); color: var(--text); padding: 15px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 80px; }

        /* --- UI COMPONENTS --- */
        .gamer-hud { width: 100%; max-width: 500px; display: flex; align-items: center; gap: 15px; margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 50px; border: 1px solid #333; }
        .rank-badge { background: var(--xp); color: #000; font-weight: 800; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; box-shadow: 0 0 10px var(--xp); }
        .xp-track { width: 100%; height: 8px; background: #333; border-radius: 10px; overflow: hidden; }
        .xp-fill { height: 100%; background: var(--xp); width: 0%; transition: 0.5s; }

        /* --- SLIDER SECTION --- */
        .config-panel { width: 100%; max-width: 500px; background: #111; padding: 15px; border-radius: 15px; border: 1px solid #222; margin-bottom: 15px; }
        .slider-row { margin: 10px 0; }
        .slider-label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px; font-weight: 700; color: #aaa; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--xp); }

        .challenge-box { width: 100%; max-width: 500px; margin-bottom: 15px; background: #1a0b05; border: 1px solid var(--fire); border-radius: 12px; padding: 15px; text-align: center; }
        .hud-chart { width: 100%; max-width: 500px; height: 220px; position: relative; margin-bottom: 15px; }
        .chart-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .balance-big { font-size: 2.2rem; font-weight: 800; }

        /* --- BARS --- */
        .rule-container { width: 100%; max-width: 500px; display: grid; gap: 10px; }
        .rule-card { background: var(--card); padding: 12px; border-radius: 10px; border-left: 4px solid #555; }
        .rule-header { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 5px; font-weight: 700; }
        .rule-bar-bg { background: rgba(255,255,255,0.05); height: 6px; border-radius: 10px; }
        .rule-bar-fill { height: 100%; border-radius: 10px; transition: 0.5s; }
        .rc-needs { border-color: var(--needs); } .rc-wants { border-color: var(--wants); } .rc-saves { border-color: var(--saves); }

        /* --- GOAL TIMER --- */
        .goal-timer { font-size: 0.75rem; color: var(--saves); margin-top: 8px; font-weight: 700; display: none; }

        .fab { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: #fff; color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; z-index: 90; cursor: pointer; }
        .panel { position: fixed; bottom: 0; left: 0; width: 100%; background: #151515; padding: 30px; border-radius: 25px 25px 0 0; transform: translateY(100%); transition: 0.3s; z-index: 95; border-top: 2px solid var(--xp); }
        .panel.open { transform: translateY(0); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .hidden { display: none; }
        .input-std { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid #333; color: white; border-radius: 8px; }
        .btn-primary { width: 100%; padding: 12px; background: var(--needs); color: white; border: none; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; }
    </style>
</head>
<body>

    <div class="modal" id="setupModal">
        <div style="background:var(--card); padding:25px; border-radius:20px; width:90%; max-width:400px; text-align:center;">
            <h2 style="margin-bottom:20px;">System Init</h2>
            <input type="number" id="setupIncome" class="input-std" placeholder="Monthly Income">
            <button class="btn-primary" onclick="completeSetup()">Start</button>
        </div>
    </div>

    <div class="modal hidden" id="goalModal">
        <div style="background:var(--card); padding:25px; border-radius:20px; width:90%; max-width:400px; text-align:center;">
            <h2 style="margin-bottom:15px;">Target Goal</h2>
            <input type="text" id="newGoalName" class="input-std" placeholder="What are you buying?">
            <input type="number" id="newGoalCost" class="input-std" placeholder="Cost (‚Çπ)">
            <label style="font-size: 0.8rem; color: #888; display: block; text-align: left; margin-bottom: 5px;">Target Date:</label>
            <input type="date" id="newGoalDate" class="input-std">
            <button class="btn-primary" style="background:var(--saves)" onclick="setGoal()">Set Goal</button>
            <div style="margin-top:10px; cursor:pointer; color:#666;" onclick="closeGoalModal()">Cancel</div>
        </div>
    </div>

    <div class="gamer-hud">
        <div class="rank-badge" id="rankBadge">Level 1</div>
        <div class="xp-track"><div class="xp-fill" id="xpBar"></div></div>
    </div>

    <div class="config-panel">
        <div class="slider-label"><span>ADJUST RULE RATIO</span><span id="ratioDisplay">50 / 30 / 20</span></div>
        <div class="slider-row">
            <input type="range" id="needsSlider" min="10" max="80" value="50" oninput="adjustRules()">
        </div>
        <div class="slider-row">
            <input type="range" id="wantsSlider" min="10" max="80" value="30" oninput="adjustRules()">
        </div>
    </div>

    <div class="challenge-box" id="challengeBox"></div>

    <div class="hud-chart">
        <canvas id="mainChart"></canvas>
        <div class="chart-center">
            <div style="font-size:0.8rem; color:var(--dim);">WALLET</div>
            <div class="balance-big" id="displayBalance">‚Çπ0</div>
        </div>
    </div>

    <div class="rule-container">
        <div class="rule-card rc-needs">
            <div class="rule-header"><span id="needsLabelText">NEEDS (50%)</span><span><span id="needsSpent">0</span> / <span id="needsLimit">0</span></span></div>
            <div class="rule-bar-bg"><div class="rule-bar-fill" id="barNeeds" style="width:0%; background:var(--needs)"></div></div>
        </div>
        <div class="rule-card rc-wants">
            <div class="rule-header"><span id="wantsLabelText">WANTS (30%)</span><span><span id="wantsSpent">0</span> / <span id="wantsLimit">0</span></span></div>
            <div class="rule-bar-bg"><div class="rule-bar-fill" id="barWants" style="width:0%; background:var(--wants)"></div></div>
        </div>
        <div class="rule-card rc-saves" onclick="openGoalModal()" style="cursor:pointer;">
            <div class="rule-header"><span id="savingsTitle">SAVINGS</span><span id="savingsText">0</span></div>
            <div class="rule-bar-bg"><div class="rule-bar-fill" id="barSaved" style="width:0%; background:var(--saves)"></div></div>
            <div id="goalTimer" class="goal-timer"></div>
        </div>
    </div>

    <div class="reset-zone" style="margin-top:20px; color:#333; font-size:0.7rem; cursor:pointer;" onclick="resetSystem()">[ RESET SYSTEM ]</div>

    <div class="fab" onclick="openPanel()"><i class="fa-solid fa-plus"></i></div>
    <div class="panel" id="addPanel">
        <input type="number" id="amtInput" class="input-std" placeholder="Amount (‚Çπ)">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px;">
            <button class="btn-primary" onclick="addExpense('needs')">Need</button>
            <button class="btn-primary" style="background:var(--wants)" onclick="addExpense('wants')">Want</button>
        </div>
        <button class="btn-primary" style="background:#333" onclick="closePanel()">Cancel</button>
    </div>

    <script>
        let data = {
            xp: 0, level: 1, income: 0, balance: 0,
            ratios: { needs: 50, wants: 30, saves: 20 },
            challenge: { active: false, start: null },
            goal: { name: "", cost: 0, saved: 0, date: "" },
            expenses: { needs: 0, wants: 0 }
        };

        let chartInst;

        window.onload = () => {
            if(localStorage.getItem('lootV10')) {
                data = JSON.parse(localStorage.getItem('lootV10'));
                document.getElementById('setupModal').classList.add('hidden');
                document.getElementById('needsSlider').value = data.ratios.needs;
                document.getElementById('wantsSlider').value = data.ratios.wants;
                initChart();
                updateUI();
            }
        };

        function completeSetup() {
            const inc = parseFloat(document.getElementById('setupIncome').value);
            if(!inc) return;
            data.income = inc;
            data.balance = inc;
            saveData();
            location.reload();
        }

        function adjustRules() {
            let n = parseInt(document.getElementById('needsSlider').value);
            let w = parseInt(document.getElementById('wantsSlider').value);
            
            if(n + w > 90) { // Keep at least 10% for savings
                w = 90 - n;
                document.getElementById('wantsSlider').value = w;
            }
            
            data.ratios.needs = n;
            data.ratios.wants = w;
            data.ratios.saves = 100 - (n + w);
            updateUI();
            saveData();
        }

        function addExpense(type) {
            const amt = parseFloat(document.getElementById('amtInput').value);
            if(!amt) return;
            if(data.challenge.active) { alert("Challenge Failed!"); data.challenge.active = false; }
            
            data.balance -= amt;
            data.expenses[type] += amt;
            data.xp += 15;
            if(data.xp >= 100) { data.xp=0; data.level++; confetti(); }
            
            closePanel();
            document.getElementById('amtInput').value = "";
            saveData();
            updateUI();
        }

        function setGoal() {
            data.goal.name = document.getElementById('newGoalName').value;
            data.goal.cost = parseFloat(document.getElementById('newGoalCost').value);
            data.goal.date = document.getElementById('newGoalDate').value;
            closeGoalModal();
            saveData();
            updateUI();
        }

        function updateUI() {
            // Limits
            const nLimit = (data.income * data.ratios.needs) / 100;
            const wLimit = (data.income * data.ratios.wants) / 100;
            const sLimit = (data.income * data.ratios.saves) / 100;

            document.getElementById('ratioDisplay').innerText = `${data.ratios.needs} / ${data.ratios.wants} / ${data.ratios.saves}`;
            document.getElementById('needsLabelText').innerText = `NEEDS (${data.ratios.needs}%)`;
            document.getElementById('wantsLabelText').innerText = `WANTS (${data.ratios.wants}%)`;

            document.getElementById('needsSpent').innerText = data.expenses.needs;
            document.getElementById('needsLimit').innerText = nLimit;
            document.getElementById('wantsSpent').innerText = data.expenses.wants;
            document.getElementById('wantsLimit').innerText = wLimit;

            document.getElementById('barNeeds').style.width = Math.min(100, (data.expenses.needs/nLimit)*100) + "%";
            document.getElementById('barWants').style.width = Math.min(100, (data.expenses.wants/wLimit)*100) + "%";

            // Goal/Savings
            const title = document.getElementById('savingsTitle');
            const timer = document.getElementById('goalTimer');
            if(data.goal.cost > 0) {
                title.innerText = `TARGET: ${data.goal.name.toUpperCase()}`;
                const savedSoFar = sLimit; // Using monthly save as current progress for simplicity
                const perc = Math.min(100, (savedSoFar/data.goal.cost)*100);
                document.getElementById('barSaved').style.width = perc + "%";
                document.getElementById('savingsText').innerText = `‚Çπ${savedSoFar} / ‚Çπ${data.goal.cost}`;

                if(data.goal.date) {
                    const days = Math.ceil((new Date(data.goal.date) - new Date()) / (1000*60*60*24));
                    if(days > 0) {
                        const daily = ((data.goal.cost - savedSoFar) / days).toFixed(0);
                        timer.style.display = "block";
                        timer.innerText = `‚è≥ ${days} DAYS LEFT | SAVE ‚Çπ${daily}/DAY`;
                    }
                }
            } else {
                title.innerText = "SAVINGS";
                document.getElementById('savingsText').innerText = `‚Çπ${sLimit}`;
                document.getElementById('barSaved').style.width = "100%";
            }

            document.getElementById('displayBalance').innerText = `‚Çπ${data.balance}`;
            document.getElementById('rankBadge').innerText = `Level ${data.level}`;
            document.getElementById('xpBar').style.width = data.xp + "%";
            
            renderChallenge();
            if(chartInst) {
                chartInst.data.datasets[0].data = [data.balance, data.income - data.balance];
                chartInst.update();
            }
        }

        function renderChallenge() {
            const box = document.getElementById('challengeBox');
            if(!data.challenge.active) {
                box.innerHTML = `<button class="btn-primary" style="background:var(--fire)" onclick="startChallenge()">Start No-Spend Week</button>`;
            } else {
                box.innerHTML = `<div style="color:var(--fire); font-weight:800;">üî• NO-SPEND STREAK ACTIVE</div>`;
            }
        }

        function startChallenge() { data.challenge.active = true; saveData(); updateUI(); }
        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            chartInst = new Chart(ctx, {
                type: 'doughnut',
                data: { datasets: [{ data: [100, 0], backgroundColor: ['#fff', '#222'], borderWidth: 0, cutout: '85%' }] },
                options: { plugins: { legend: { display: false } } }
            });
        }
        function openPanel() { document.getElementById('addPanel').classList.add('open'); }
        function closePanel() { document.getElementById('addPanel').classList.remove('open'); }
        function openGoalModal() { document.getElementById('goalModal').classList.remove('hidden'); }
        function closeGoalModal() { document.getElementById('goalModal').classList.add('hidden'); }
        function resetSystem() { if(confirm("Delete all?")) { localStorage.clear(); location.reload(); } }
        function saveData() { localStorage.setItem('lootV10', JSON.stringify(data)); }
    </script>
</body>
</html>
